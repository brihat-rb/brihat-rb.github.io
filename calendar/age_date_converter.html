<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <title>Date Converter | Age Calculator | Events of the day</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./age_date_converter.css" />
  </head>

  <body>
    <i id="datetime"></i>
    <div id="today_info"></div>
    <br />
    <h2 onclick="toggle_content('date_converter')" title="Click to convert date">AD BS Date Converter</h2>
    <div class="main_div" id="date_converter">
      <div id="ad_to_bs">
        <div class="input">AD: <input type="date" id="ad_date" />
          <button id="button_to_bs" onclick="to_bs();">GET BS</button>
        </div>
        <div id="bs_result">BS here</div>
      </div>
      <div id="bs_to_ad">
        <div class="input">BS:
          <select id="select_year"></select>
          <select id="select_month"></select>
          <select id="select_date"></select>
          <button id="button_to_ad" onclick="to_ad();">GET AD</button>
        </div>
        <div id="ad_result">AD here</div>
      </div>
    </div>

    <h2 onclick="toggle_content('age_calculator')" title="Click to calculate age">Age Calculator</h1>
    <div class="main_div" id="age_calculator">
      <div id="age_calculator_ad">
        <div class="age_header">Calculate from AD Date</div>
        <div class="input">Birthdate: <input type="date" id="date1" /></div>
        <div class="input">As of date: <input type="date" id="date2" /></div>
        <button id="button" onclick="date_diff_ad();">Calculate</button>
      </div>

      <div id="age_calculator_bs">
        <div class="age_header">Calculate from BS Date</div>
        <div class="input">Birthdate:
          <select id="select_birthdate_year"></select>
          <select id="select_birthdate_month"></select>
          <select id="select_birthdate_date"></select>
        </div>
        <div class="input">As of date:
          <select id="select_asof_year"></select>
          <select id="select_asof_month"></select>
          <select id="select_asof_date"></select>
        </div>
        <button id="button" onclick="date_diff_bs();">Calculate</button>
      </div>
    </div>
    <div id="age_result"></div>

    <h2 onclick="toggle_content('date_event')" title="Click to get event of date">Events of the Day</h2>
    <div class="main_div" id="date_event">
      <div id="bs_to_ad">
        <div class="input">BS:
          <select id="select_event_year" disabled></select>
          <select id="select_event_month"></select>
          <select id="select_event_date"></select>
          <button id="button_event" onclick="get_event();">GET EVENT</button>
        </div>
      </div>
    </div>
    <div id="event_here"></div>
    <br />

    <div id="user_info">
      <span id="user_ip"></span>&emsp;
      <span id="user_geolocation"></span>
    </div>

    <div id="footer">&spades; <a href="https://brihat-rb.github.io/">Brihat</a> &spades;</div>

    <script>
      var request = new XMLHttpRequest();
      url = 'https://ipinfo.io/?token=6630ba13ce995d';
      request.open('GET', url, true);
      request.onload = function() {
        response = JSON.parse(this.response);
        document.getElementById("user_ip").innerHTML = response["ip"];
        document.getElementById("user_geolocation").innerHTML = response["loc"];
      }
      request.send();
    </script>

    <script>
      let main_divs = document.getElementsByClassName("main_div");
      let div_id_list = [];
      for (let main_div of main_divs) {
        div_id_list.push(main_div.id);
      }

      function hide_other(one_div, div_list) {
        div_list.forEach(function(div_id) {
          if (div_id != one_div) {
              let div_container = document.getElementById(div_id);
              div_container.style.display = "none";
              div_container.style.maxHeight = null;
          }
        });
        document.getElementById("age_result").innerHTML = "";
        document.getElementById("event_here").innerHTML = "";
      }

      function toggle_content(div_id) {
        let div_container = document.getElementById(div_id);
        if (div_container.style.display === "none") {
          div_container.style.display = "flex";
          div_container.style.maxHeight = div_container.scrollHeight * 2 + "px";
        }
        else if (div_container.style.display === "flex") {
          div_container.style.display = "none";
          div_container.style.maxHeight = null;
        }
        else {
          div_container.style.display = "flex";
          div_container.style.maxHeight = div_container.scrollHeight * 2 + "px";
        }
        hide_other(div_id, div_id_list);
      }
    </script>

    <script type="text/javascript" src="./nepali_calendar_tools.js"></script>

    <!-- for topmost date display -->
    <script>
      function showtime() {
        let dt = new Date();
        let bs_date = get_nep_bs_date_from_date_object(dt);
        let date_content = ""
        date_content += '<span id="nep_date">' + bs_date + '</span> ';
        date_content += '<span id="time">' + dt.toLocaleTimeString() + '</span> ';
        date_content += '<span id="eng_date">' + ad_string_from_date(dt) + '</span> ';
        document.getElementById("datetime").innerHTML = date_content;
        setTimeout("showtime()", 500);
      }
      showtime();
    </script>

    <script>
      var nepal_event_req = new XMLHttpRequest();
      // json_url = 'https://raw.githubusercontent.com/brihat-rb/brihat-rb.github.io/master/calendar/data/2077.json';
      json_url = 'https://raw.githubusercontent.com/brihat-rb/brihat-rb.github.io/master/calendar/data/2077_detailed.json';
      nepal_event_req.open('GET', json_url, true);
      nepal_event_req.onload = function() {
        let events = JSON.parse(this.response);
        let bs_today = get_bs_date_from_date_object(new Date()).split(" ");
        let month = get_bs_month(bs_today[1]) - 1;
        let date = bs_today[2] - 1;

        let info_content = "";
        info_content += '<div id="tithi">' + events.data[month][date].pakshya + " " + events.data[month][date].tithi + '</div>';
        if (events.data[month][date].event_one)
          info_content += '<div id="info1">' + events.data[month][date].event_one + '</div>';
        if (events.data[month][date].rotate_left)
          info_content += '<div id="info2">' + events.data[month][date].rotate_left + '</div>';
        if (events.data[month][date].rotate_right)
          info_content += '<div id="info3">' + events.data[month][date].rotate_right + '</div>';
        document.getElementById("today_info").innerHTML = info_content;
      }
      nepal_event_req.send();
    </script>

    <script>
      function get_event() {
        let bs_year = document.getElementById("select_event_year").value;
        let bs_month = document.getElementById("select_event_month").value;
        let bs_date = document.getElementById("select_event_date").value;

        if (bs_year != 2077) {
          alert("Event not available for year '" + bs_year + "' BS");
        }

        var nepal_event_req = new XMLHttpRequest();
        // json_url = 'https://raw.githubusercontent.com/brihat-rb/brihat-rb.github.io/master/calendar/data/' + bs_year + '.json';
        json_url = 'https://raw.githubusercontent.com/brihat-rb/brihat-rb.github.io/master/calendar/data/' + bs_year + '_detailed.json';
        nepal_event_req.open('GET', json_url, true);
        nepal_event_req.onload = function() {
          let events = JSON.parse(this.response);

          let nepali_date = "<br />";
          nepali_date += '<div id="date"><b><u>' + arabic_number_to_nepali(bs_year) + " ";
          nepali_date += BS_MONTHS_NEP[bs_month-1] + " ";
          nepali_date += arabic_number_to_nepali(bs_date) + ", ";
          nepali_date += NEPALI_DAYS[new Date(convert_bs_to_ad(bs_year, bs_month, bs_date)).getDay()] + ' </u></b></div><br />';

          let info_content = nepali_date;
          info_content += '<div id="tithi">' + events.data[bs_month - 1][bs_date - 1].lunar_month;
          info_content += " (" + events.data[bs_month - 1][bs_date - 1].pakshya + ") ";
          info_content += events.data[bs_month - 1][bs_date - 1].tithi + '</div>';
          if (events.data[bs_month - 1][bs_date - 1].event_one)
            info_content += '<div id="info1">' + events.data[bs_month - 1][bs_date - 1].event_one + '</div>';
          if (events.data[bs_month - 1][bs_date - 1].rotate_left)
            info_content += '<div id="info2">' + events.data[bs_month - 1][bs_date - 1].rotate_left + '</div>';
          if (events.data[bs_month - 1][bs_date - 1].rotate_right)
            info_content += '<div id="info3">' + events.data[bs_month - 1][bs_date - 1].rotate_right + '</div>';
          document.getElementById("event_here").innerHTML = info_content;
        }
        nepal_event_req.send();
      }
      get_event();
      toggle_content('date_event');
    </script>
  </body>
</html>
